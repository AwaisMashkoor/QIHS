<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACP Trigger Points Decision Tree</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .game-container {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .game-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
            position: relative;
        }

        .game-header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .game-header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        .score-board {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
        }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            transition: width 0.5s ease;
            width: 0%;
        }

        .game-content {
            padding: 40px;
        }

        .scenario-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .scenario-container.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .patient-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #dee2e6;
            position: relative;
        }

        .patient-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .patient-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .patient-info h2 {
            color: #2c3e50;
            font-size: 1.6rem;
            margin-bottom: 5px;
        }

        .patient-meta {
            color: #7f8c8d;
            font-size: 1rem;
        }

        .patient-story {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 1.05rem;
            color: #2c3e50;
            border-left: 4px solid #3498db;
        }

        .timeline-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
        }

        .timeline-title {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .timeline {
            position: relative;
            padding: 20px 0;
        }

        .timeline-line {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #e0e0e0;
            transform: translateX(-50%);
        }

        .timeline-events {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .timeline-event {
            display: flex;
            align-items: center;
            position: relative;
            opacity: 0;
            animation: slideIn 0.5s ease forwards;
        }

        .timeline-event:nth-child(1) { animation-delay: 0.1s; }
        .timeline-event:nth-child(2) { animation-delay: 0.2s; }
        .timeline-event:nth-child(3) { animation-delay: 0.3s; }
        .timeline-event:nth-child(4) { animation-delay: 0.4s; }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .timeline-event:nth-child(odd) {
            flex-direction: row-reverse;
        }

        .timeline-dot {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            border: 3px solid #3498db;
            z-index: 1;
        }

        .timeline-dot.trigger {
            background: #f39c12;
            border-color: #e67e22;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.2); }
        }

        .timeline-content {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 0 60px;
            position: relative;
        }

        .timeline-content.highlight {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .timeline-date {
            font-weight: 600;
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .timeline-text {
            color: #2c3e50;
            line-height: 1.4;
        }

        .decision-section {
            background: linear-gradient(135deg, #f093fb10, #f5576c10);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid #f093fb40;
        }

        .decision-question {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 600;
        }

        .decision-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .decision-btn {
            padding: 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .decision-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .decision-btn.selected {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-color: #667eea;
        }

        .decision-btn-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .decision-btn-text {
            font-size: 1.1rem;
            color: #2c3e50;
            font-weight: 500;
            text-align: center;
            line-height: 1.4;
        }

        .feedback-container {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s ease;
        }

        .feedback-container.show {
            display: block;
        }

        .feedback-card {
            border-radius: 15px;
            padding: 25px;
            position: relative;
        }

        .feedback-card.correct {
            background: #d4edda;
            border: 2px solid #28a745;
        }

        .feedback-card.incorrect {
            background: #f8d7da;
            border: 2px solid #dc3545;
        }

        .feedback-card.partial {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .feedback-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-card.correct .feedback-title { color: #155724; }
        .feedback-card.incorrect .feedback-title { color: #721c24; }
        .feedback-card.partial .feedback-title { color: #856404; }

        .feedback-text {
            color: #2c3e50;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .learning-point {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .learning-point-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .learning-point-text {
            color: #5a6c7d;
            line-height: 1.4;
        }

        .next-btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .results-screen {
            display: none;
            text-align: center;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }

        .results-screen.show {
            display: block;
        }

        .results-title {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .results-score {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 2px solid #e0e0e0;
        }

        .result-card-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .result-card-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .restart-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(39, 174, 96, 0.3);
        }

        .trigger-badge {
            display: inline-block;
            padding: 5px 15px;
            background: #f39c12;
            color: white;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .game-header h1 {
                font-size: 1.8rem;
            }

            .score-board {
                position: static;
                margin-top: 20px;
                background: rgba(255, 255, 255, 0.3);
            }

            .timeline {
                padding-left: 40px;
            }

            .timeline-line {
                left: 20px;
            }

            .timeline-event {
                flex-direction: row !important;
            }

            .timeline-dot {
                left: 20px;
            }

            .timeline-content {
                margin: 0 0 0 40px;
            }

            .decision-options {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>üéØ ACP Trigger Points: Decision Challenge</h1>
            <p>Can you identify the right moments to initiate Anticipatory Care Planning?</p>
            <div class="score-board">
                Score: <span id="score">0</span> / <span id="total">0</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
        </div>

        <div class="game-content">
            <!-- Scenario 1: Richard -->
            <div class="scenario-container active" data-scenario="1">
                <div class="patient-card">
                    <div class="patient-header">
                        <div class="patient-avatar">üë¥</div>
                        <div class="patient-info">
                            <h2>Richard Thompson</h2>
                            <div class="patient-meta">72 years old | COPD | Lives alone</div>
                        </div>
                    </div>
                    <div class="patient-story">
                        Richard was diagnosed with COPD five years ago. He's a retired mechanic, fiercely independent, and lives alone with his dog, Buddy. His wife passed away two years ago, and his daughter lives in Australia. He manages his condition reasonably well most of the time.
                    </div>
                </div>

                <div class="timeline-container">
                    <h3 class="timeline-title">üìÖ Richard's Healthcare Journey</h3>
                    <div class="timeline">
                        <div class="timeline-line"></div>
                        <div class="timeline-events">
                            <div class="timeline-event">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">5 years ago</div>
                                    <div class="timeline-text">Diagnosed with COPD after persistent cough</div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">2 years ago</div>
                                    <div class="timeline-text">Wife passed away from cancer</div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot trigger"></div>
                                <div class="timeline-content highlight">
                                    <div class="timeline-date">6 months ago</div>
                                    <div class="timeline-text">First emergency admission - severe breathlessness<span class="trigger-badge">TRIGGER?</span></div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot trigger"></div>
                                <div class="timeline-content highlight">
                                    <div class="timeline-date">Present</div>
                                    <div class="timeline-text">Third hospital admission this year<span class="trigger-badge">TRIGGER?</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="decision-section">
                    <div class="decision-question">
                        ü§î When should you initiate an ACP conversation with Richard?
                    </div>
                    <div class="decision-options">
                        <button class="decision-btn" onclick="selectOption(1, 'diagnosis')">
                            <div class="decision-btn-icon">üìã</div>
                            <div class="decision-btn-text">At initial COPD diagnosis</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(1, 'bereavement')">
                            <div class="decision-btn-icon">üíî</div>
                            <div class="decision-btn-text">After his wife's death</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(1, 'first-admission')">
                            <div class="decision-btn-icon">üöë</div>
                            <div class="decision-btn-text">After first emergency admission</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(1, 'repeated')">
                            <div class="decision-btn-icon">üîÑ</div>
                            <div class="decision-btn-text">Now, after repeated admissions</div>
                        </button>
                    </div>
                </div>

                <div class="feedback-container" id="feedback-1"></div>
            </div>

            <!-- Scenario 2: Maria -->
            <div class="scenario-container" data-scenario="2">
                <div class="patient-card">
                    <div class="patient-header">
                        <div class="patient-avatar">üë©</div>
                        <div class="patient-info">
                            <h2>Maria Santos</h2>
                            <div class="patient-meta">29 years old | Multiple Sclerosis | Software Developer</div>
                        </div>
                    </div>
                    <div class="patient-story">
                        Maria was diagnosed with relapsing-remitting MS eighteen months ago. She's ambitious, tech-savvy, and focused on her career at a startup. Her partner works overseas, and she values her independence highly. She's currently on disease-modifying therapy and managing well.
                    </div>
                </div>

                <div class="timeline-container">
                    <h3 class="timeline-title">üìÖ Maria's Healthcare Journey</h3>
                    <div class="timeline">
                        <div class="timeline-line"></div>
                        <div class="timeline-events">
                            <div class="timeline-event">
                                <div class="timeline-dot trigger"></div>
                                <div class="timeline-content highlight">
                                    <div class="timeline-date">18 months ago</div>
                                    <div class="timeline-text">MS diagnosis after vision problems<span class="trigger-badge">TRIGGER?</span></div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">1 year ago</div>
                                    <div class="timeline-text">Started disease-modifying therapy</div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot trigger"></div>
                                <div class="timeline-content highlight">
                                    <div class="timeline-date">3 months ago</div>
                                    <div class="timeline-text">First relapse - temporary mobility issues<span class="trigger-badge">TRIGGER?</span></div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">Present</div>
                                    <div class="timeline-text">Stable, planning career progression</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="decision-section">
                    <div class="decision-question">
                        ü§î What's the most appropriate trigger for Maria's ACP?
                    </div>
                    <div class="decision-options">
                        <button class="decision-btn" onclick="selectOption(2, 'wait')">
                            <div class="decision-btn-icon">‚è≥</div>
                            <div class="decision-btn-text">Wait until disease progresses</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(2, 'diagnosis')">
                            <div class="decision-btn-icon">üéØ</div>
                            <div class="decision-btn-text">Soon after MS diagnosis</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(2, 'relapse')">
                            <div class="decision-btn-icon">üìâ</div>
                            <div class="decision-btn-text">After first relapse</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(2, 'never')">
                            <div class="decision-btn-icon">‚ùå</div>
                            <div class="decision-btn-text">Not needed - she's young & stable</div>
                        </button>
                    </div>
                </div>

                <div class="feedback-container" id="feedback-2"></div>
            </div>

            <!-- Scenario 3: Khalid -->
            <div class="scenario-container" data-scenario="3">
                <div class="patient-card">
                    <div class="patient-header">
                        <div class="patient-avatar">üë®</div>
                        <div class="patient-info">
                            <h2>Khalid Ahmed</h2>
                            <div class="patient-meta">55 years old | Heart Failure | Restaurant Owner</div>
                        </div>
                    </div>
                    <div class="patient-story">
                        Khalid runs a successful family restaurant with his sons. Diagnosed with heart failure last year, he's struggling to slow down. His family is closely involved in all decisions, reflecting their cultural values. He's been stable on medication but finding daily tasks increasingly difficult.
                    </div>
                </div>

                <div class="timeline-container">
                    <h3 class="timeline-title">üìÖ Khalid's Healthcare Journey</h3>
                    <div class="timeline">
                        <div class="timeline-line"></div>
                        <div class="timeline-events">
                            <div class="timeline-event">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">1 year ago</div>
                                    <div class="timeline-text">Heart failure diagnosis after chest pain</div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot"></div>
                                <div class="timeline-content">
                                    <div class="timeline-date">8 months ago</div>
                                    <div class="timeline-text">Started cardiac rehabilitation</div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot trigger"></div>
                                <div class="timeline-content highlight">
                                    <div class="timeline-date">2 months ago</div>
                                    <div class="timeline-text">Can't work full days anymore<span class="trigger-badge">TRIGGER?</span></div>
                                </div>
                            </div>
                            <div class="timeline-event">
                                <div class="timeline-dot trigger"></div>
                                <div class="timeline-content highlight">
                                    <div class="timeline-date">Present</div>
                                    <div class="timeline-text">Considering ICD placement<span class="trigger-badge">TRIGGER?</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="decision-section">
                    <div class="decision-question">
                        ü§î Considering Khalid's situation, when should ACP be initiated?
                    </div>
                    <div class="decision-options">
                        <button class="decision-btn" onclick="selectOption(3, 'decline')">
                            <div class="decision-btn-icon">üìä</div>
                            <div class="decision-btn-text">When functional decline noticed</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(3, 'surgery')">
                            <div class="decision-btn-icon">‚ö°</div>
                            <div class="decision-btn-text">Before ICD procedure</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(3, 'both')">
                            <div class="decision-btn-icon">‚úÖ</div>
                            <div class="decision-btn-text">Both moments are appropriate</div>
                        </button>
                        <button class="decision-btn" onclick="selectOption(3, 'family')">
                            <div class="decision-btn-icon">üë®‚Äçüë©‚Äçüë¶</div>
                            <div class="decision-btn-text">Only when family requests it</div>
                        </button>
                    </div>
                </div>

                <div class="feedback-container" id="feedback-3"></div>
            </div>

            <!-- Results Screen -->
            <div class="results-screen" id="results">
                <h2 class="results-title">üéâ Challenge Complete!</h2>
                <div class="results-score" id="final-score">0/0</div>
                
                <div class="results-grid">
                    <div class="result-card">
                        <div class="result-card-title">Correct Triggers</div>
                        <div class="result-card-value" id="correct-count">0</div>
                    </div>
                    <div class="result-card">
                        <div class="result-card-title">Learning Points</div>
                        <div class="result-card-value" id="learning-count">0</div>
                    </div>
                    <div class="result-card">
                        <div class="result-card-title">Confidence Level</div>
                        <div class="result-card-value" id="confidence">0%</div>
                    </div>
                </div>

                <button class="restart-btn" onclick="restartGame()">
                    Try Different Scenarios üîÑ
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentScenario = 1;
        let totalScenarios = 3;
        let score = 0;
        let responses = [];

        const feedbackData = {
            1: { // Richard
                'diagnosis': {
                    type: 'partial',
                    title: '‚ö†Ô∏è Good thinking, but timing could be better',
                    text: 'Starting ACP at diagnosis is valuable, but not everyone is ready to process future planning while adjusting to a new diagnosis.',
                    learning: 'Best practice: Introduce ACP within weeks/months of diagnosis, once the initial shock has settled.'
                },
                'bereavement': {
                    type: 'partial',
                    title: '‚ö†Ô∏è Sensitive moment',
                    text: 'Bereavement can prompt reflection on mortality, but grief may cloud decision-making initially.',
                    learning: 'Consider: Wait 3-6 months post-bereavement, then gently explore if they\'re ready to discuss their own wishes.'
                },
                'first-admission': {
                    type: 'correct',
                    title: '‚úÖ Excellent choice!',
                    text: 'First emergency admission is an ideal trigger. Richard has experienced the reality of his condition but isn\'t in crisis.',
                    learning: 'Key insight: Post-crisis stability offers the perfect window - experience is fresh but emotions are settled.'
                },
                'repeated': {
                    type: 'correct',
                    title: '‚úÖ Absolutely right!',
                    text: 'Repeated admissions clearly indicate the need for proactive planning. This pattern suggests deterioration.',
                    learning: 'Remember: The revolving door pattern is a clear sign that reactive care isn\'t working.'
                }
            },
            2: { // Maria
                'wait': {
                    type: 'incorrect',
                    title: '‚ùå Missed opportunity',
                    text: 'Waiting for progression means missing the chance for Maria to express her values while fully capacitated.',
                    learning: 'Critical point: Young people with chronic conditions deserve early ACP to maintain control over their long trajectory.'
                },
                'diagnosis': {
                    type: 'correct',
                    title: '‚úÖ Perfect timing!',
                    text: 'Early ACP for young people with MS is best practice. Maria can plan proactively while cognitive function is intact.',
                    learning: 'Evidence shows: Early ACP in MS leads to better quality of life and maintained autonomy throughout disease course.'
                },
                'relapse': {
                    type: 'correct',
                    title: '‚úÖ Good trigger point!',
                    text: 'First relapse makes the condition real. Maria now understands what decline feels like.',
                    learning: 'Relapses are natural conversation points: "Now you\'ve experienced changes, let\'s plan for future ones."'
                },
                'never': {
                    type: 'incorrect',
                    title: '‚ùå Common misconception',
                    text: 'Age and current stability don\'t negate ACP need. MS is unpredictable, and young people have more years of potential change.',
                    learning: 'Remember: ACP isn\'t just for end-of-life. It\'s especially valuable for those with long disease trajectories.'
                }
            },
            3: { // Khalid
                'decline': {
                    type: 'correct',
                    title: '‚úÖ Well spotted!',
                    text: 'Functional decline is a key trigger. Khalid can\'t work full days - this transition point is ideal for planning.',
                    learning: 'Functional changes are concrete triggers patients understand: "As things change, let\'s plan together."'
                },
                'surgery': {
                    type: 'correct',
                    title: '‚úÖ Absolutely right!',
                    text: 'Pre-procedure ACP is essential. ICD decisions involve quality vs quantity of life discussions.',
                    learning: 'High-risk interventions require ACP: What if complications occur? What are the goals of treatment?'
                },
                'both': {
                    type: 'correct',
                    title: '‚úÖ Excellent understanding!',
                    text: 'You\'ve recognized multiple valid triggers. ACP is an ongoing process, not a single conversation.',
                    learning: 'Best practice: Use multiple triggers to revisit and refine ACP as circumstances evolve.'
                },
                'family': {
                    type: 'incorrect',
                    title: '‚ùå Too passive',
                    text: 'Waiting for family requests means missing proactive opportunities. Healthcare professionals should lead.',
                    learning: 'Cultural sensitivity is important, but we should still initiate discussions and include family as Khalid wishes.'
                }
            }
        };

        function selectOption(scenario, choice) {
            // Visual feedback
            event.target.closest('.decision-btn').classList.add('selected');
            
            // Disable other buttons
            document.querySelectorAll(`[data-scenario="${scenario}"] .decision-btn`).forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.6';
                btn.style.cursor = 'not-allowed';
            });

            // Show feedback
            const feedback = feedbackData[scenario][choice];
            const feedbackHTML = `
                <div class="feedback-card ${feedback.type}">
                    <div class="feedback-title">
                        ${feedback.title}
                    </div>
                    <div class="feedback-text">
                        ${feedback.text}
                    </div>
                    <div class="learning-point">
                        <div class="learning-point-title">
                            <span>üìö</span> Learning Point
                        </div>
                        <div class="learning-point-text">
                            ${feedback.learning}
                        </div>
                    </div>
                    <button class="next-btn" onclick="nextScenario()">
                        ${scenario < totalScenarios ? 'Next Case ‚Üí' : 'See Results üèÜ'}
                    </button>
                </div>
            `;

            const feedbackContainer = document.getElementById(`feedback-${scenario}`);
            feedbackContainer.innerHTML = feedbackHTML;
            feedbackContainer.classList.add('show');

            // Update score
            if (feedback.type === 'correct') {
                score++;
            } else if (feedback.type === 'partial') {
                score += 0.5;
            }
            
            responses.push({
                scenario: scenario,
                choice: choice,
                result: feedback.type
            });

            updateScore();
            updateProgress();
        }

        function nextScenario() {
            if (currentScenario < totalScenarios) {
                // Hide current scenario
                document.querySelector(`[data-scenario="${currentScenario}"]`).classList.remove('active');
                
                // Show next scenario
                currentScenario++;
                setTimeout(() => {
                    document.querySelector(`[data-scenario="${currentScenario}"]`).classList.add('active');
                }, 300);
            } else {
                // Show results
                showResults();
            }
        }

        function updateScore() {
            document.getElementById('score').textContent = score;
            document.getElementById('total').textContent = currentScenario;
        }

        function updateProgress() {
            const progress = (currentScenario / totalScenarios) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        function showResults() {
            // Hide last scenario
            document.querySelector(`[data-scenario="${currentScenario}"]`).classList.remove('active');
            
            // Calculate results
            const correctCount = responses.filter(r => r.result === 'correct').length;
            const learningCount = responses.length;
            const confidence = Math.round((score / totalScenarios) * 100);
            
            // Display results
            document.getElementById('final-score').textContent = `${score}/${totalScenarios}`;
            document.getElementById('correct-count').textContent = correctCount;
            document.getElementById('learning-count').textContent = learningCount;
            document.getElementById('confidence').textContent = confidence + '%';
            
            // Show results screen
            document.getElementById('results').classList.add('show');
        }

        function restartGame() {
            // Reset variables
            currentScenario = 1;
            score = 0;
            responses = [];
            
            // Reset UI
            document.getElementById('results').classList.remove('show');
            document.querySelectorAll('.scenario-container').forEach(container => {
                container.classList.remove('active');
            });
            document.querySelector('[data-scenario="1"]').classList.add('active');
            
            // Reset buttons
            document.querySelectorAll('.decision-btn').forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
                btn.classList.remove('selected');
            });
            
            // Reset feedback
            document.querySelectorAll('.feedback-container').forEach(container => {
                container.classList.remove('show');
                container.innerHTML = '';
            });
            
            // Reset score and progress
            updateScore();
            updateProgress();
        }

        // Initialize
        updateScore();
        updateProgress();
    </script>
</body>
</html>