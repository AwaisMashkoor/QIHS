<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Build Your First Run Chart - Interactive Activity</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin-top: 20px;
            overflow: hidden;
        }

        .progress-fill {
            background: white;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .step-counter {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            font-weight: bold;
            color: #667eea;
        }

        .content {
            padding: 40px;
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .scenario-box {
            background: #e8eaf6;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .scenario-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .data-table {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .data-cell {
            background: white;
            border: 2px solid #667eea;
            padding: 15px;
            text-align: center;
            border-radius: 8px;
            transition: transform 0.2s;
        }

        .data-cell:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .data-cell .week {
            font-size: 0.9em;
            color: #666;
            font-weight: bold;
        }

        .data-cell .value {
            font-size: 1.4em;
            color: #667eea;
            font-weight: bold;
            margin-top: 5px;
        }

        .chart-container {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            min-height: 400px;
            position: relative;
        }

        canvas {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: crosshair;
            max-width: 100%;
        }

        .median-calculator {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .median-calculator h4 {
            color: #856404;
            margin-bottom: 15px;
        }

        .ordered-values {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }

        .ordered-value {
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-weight: bold;
            border: 2px solid #ffc107;
        }

        .ordered-value.median {
            background: #ffc107;
            color: white;
            transform: scale(1.1);
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #495057;
        }

        .input-group input {
            width: 200px;
            padding: 12px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1.1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            border-left: 5px solid #28a745;
            color: #155724;
            display: block;
        }

        .feedback.incorrect {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            color: #721c24;
            display: block;
        }

        .feedback.info {
            background: #d1ecf1;
            border-left: 5px solid #17a2b8;
            color: #0c5460;
            display: block;
        }

        .rules-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .rule-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .rule-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
        }

        .rule-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .rule-card .definition {
            font-size: 0.95em;
            color: #666;
            margin-bottom: 10px;
        }

        .checkbox-group {
            margin: 10px 0;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .checkbox-group label:hover {
            background: #e9ecef;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .question-box {
            background: #f8f9fa;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .question-box h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1em;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .model-answer {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            display: none;
        }

        .model-answer.visible {
            display: block;
        }

        .model-answer h5 {
            color: #155724;
            margin-bottom: 10px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .completion-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
        }

        .completion-summary h3 {
            font-size: 2em;
            margin-bottom: 20px;
        }

        .completion-summary .checkmark {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .key-insights {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            text-align: left;
        }

        .key-insights h4 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .key-insights ul {
            list-style: none;
            padding: 0;
        }

        .key-insights li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        .key-insights li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
            font-size: 1.2em;
        }

        .hint-button {
            background: #17a2b8;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .hint-button:hover {
            background: #138496;
        }

        .hint-box {
            background: #d1ecf1;
            border-left: 5px solid #17a2b8;
            padding: 15px;
            margin-top: 10px;
            border-radius: 8px;
            display: none;
        }

        .hint-box.visible {
            display: block;
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 1.5em;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .data-table {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .instructions h4 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .instructions ol {
            padding-left: 20px;
        }

        .instructions li {
            margin: 10px 0;
            line-height: 1.6;
        }

        .chart-legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 3px;
            border-radius: 2px;
        }

        .target-line {
            stroke: #28a745;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }

        .median-line {
            stroke: #dc3545;
            stroke-width: 2;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Build Your First Run Chart</h1>
            <p>Interactive Learning Activity - Week 9</p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
        </div>

        <div class="step-counter" id="stepCounter">Step 1 of 6: Introduction</div>

        <div class="content">
            <!-- STEP 1: INTRODUCTION -->
            <div class="step active" id="step1">
                <h2>📊 Welcome to the Run Chart Activity</h2>
                <p style="margin: 20px 0; line-height: 1.6;">In this interactive activity, you'll build a complete run chart from real-world data, calculate the median, apply run chart rules, and interpret the results critically.</p>

                <div class="scenario-box">
                    <h3>🏥 Scenario</h3>
                    <p><strong>Setting:</strong> Emergency Department</p>
                    <p><strong>Measure:</strong> Weekly Average Waiting Time (hours)</p>
                    <p><strong>Improvement Aim:</strong> Reduce waiting time to below 3.0 hours</p>
                    <p><strong>Data Period:</strong> 12 weeks</p>
                </div>

                <h3 style="margin-top: 30px;">📈 Your Data: 12 Weeks of ED Waiting Times</h3>
                <div class="data-table" id="dataDisplay"></div>

                <div class="instructions">
                    <h4>📝 What You'll Do:</h4>
                    <ol>
                        <li><strong>View the data</strong> - Familiarize yourself with 12 weeks of waiting times</li>
                        <li><strong>Plot the points</strong> - Create a time-ordered visualization</li>
                        <li><strong>Calculate the median</strong> - Find the middle value with guidance</li>
                        <li><strong>Apply run chart rules</strong> - Detect trends, shifts, and patterns</li>
                        <li><strong>Critical analysis</strong> - Interpret what the data means for improvement</li>
                        <li><strong>Summary</strong> - Review key learning and export your work</li>
                    </ol>
                </div>

                <p style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 5px solid #ffc107;">
                    <strong>⏱️ Estimated Time:</strong> 15-20 minutes<br>
                    <strong>💡 Tip:</strong> Take your time at each step. Understanding is more important than speed!
                </p>

                <div class="button-group">
                    <button class="btn-primary" onclick="nextStep()">Start Activity →</button>
                </div>
            </div>

            <!-- STEP 2: PLOTTING DATA -->
            <div class="step" id="step2">
                <h2>📍 Step 2: Plot Your Data Points</h2>
                <p style="margin: 20px 0;">Run charts show data in time order. Let's plot each week's waiting time on the chart below.</p>

                <div class="scenario-box">
                    <h3>Quick Reminder</h3>
                    <p>We're plotting <strong>time</strong> (weeks 1-12) on the X-axis and <strong>waiting time</strong> (hours) on the Y-axis.</p>
                    <p>Each point represents one week's average ED waiting time.</p>
                </div>

                <div class="chart-container">
                    <canvas id="chartCanvas" width="800" height="400"></canvas>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #667eea; width: 20px; height: 20px; border-radius: 50%;"></div>
                            <span>Data Points</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #28a745;"></div>
                            <span>Target (3.0 hours)</span>
                        </div>
                    </div>
                </div>

                <div id="plotFeedback" class="feedback"></div>

                <button class="hint-button" onclick="toggleHint('plotHint')">💡 Need a hint?</button>
                <div id="plotHint" class="hint-box">
                    <strong>Hint:</strong> Look at the pattern forming. Do you notice any overall trend? Don't worry about perfect plotting - the computer will help ensure accuracy. Focus on seeing the pattern emerge.
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn-primary" id="plotCompleteBtn" disabled onclick="nextStep()">Continue →</button>
                </div>
            </div>

            <!-- STEP 3: CALCULATE MEDIAN -->
            <div class="step" id="step3">
                <h2>🔢 Step 3: Calculate the Median</h2>
                <p style="margin: 20px 0;">The median line is your reference point. It's the middle value when all data points are ordered from smallest to largest.</p>

                <div class="median-calculator">
                    <h4>Step-by-Step Median Calculation</h4>
                    
                    <p><strong>Step 1:</strong> Order all 12 values from smallest to largest</p>
                    <div class="ordered-values" id="orderedValues"></div>

                    <p style="margin-top: 20px;"><strong>Step 2:</strong> Find the middle values</p>
                    <p>Since we have 12 data points (an even number), the median is the average of the 6th and 7th values.</p>

                    <p style="margin-top: 15px;">The 6th value is: <strong>3.5</strong></p>
                    <p>The 7th value is: <strong>3.6</strong></p>

                    <p style="margin-top: 20px;"><strong>Step 3:</strong> Calculate the average of these two values</p>
                    <p>Median = (3.5 + 3.6) ÷ 2 = ?</p>
                </div>

                <div class="input-group">
                    <label for="medianInput">Enter the median value (hours):</label>
                    <input type="number" id="medianInput" step="0.01" placeholder="e.g., 3.55">
                    <button class="btn-primary" onclick="checkMedian()" style="margin-left: 10px; min-width: 100px;">Check</button>
                </div>

                <div id="medianFeedback" class="feedback"></div>

                <button class="hint-button" onclick="toggleHint('medianHint')">💡 Need help?</button>
                <div id="medianHint" class="hint-box">
                    <strong>Calculation help:</strong><br>
                    (3.5 + 3.6) = 7.1<br>
                    7.1 ÷ 2 = 3.55<br><br>
                    The median is <strong>3.55 hours</strong>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn-primary" id="medianCompleteBtn" disabled onclick="nextStep()">Continue →</button>
                </div>
            </div>

            <!-- STEP 4: APPLY RUN CHART RULES -->
            <div class="step" id="step4">
                <h2>📏 Step 4: Apply Run Chart Rules</h2>
                <p style="margin: 20px 0;">Now that your chart has a median line, let's apply the three run chart rules to detect meaningful patterns.</p>

                <div class="chart-container">
                    <canvas id="chartCanvas2" width="800" height="400"></canvas>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #667eea; width: 20px; height: 20px; border-radius: 50%;"></div>
                            <span>Data Points</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #dc3545;"></div>
                            <span>Median (3.55 hours)</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #28a745;"></div>
                            <span>Target (3.0 hours)</span>
                        </div>
                    </div>
                </div>

                <div class="rules-section">
                    <div class="rule-card">
                        <h4>📈 Rule 1: Trend</h4>
                        <p class="definition">6 or more consecutive points all increasing OR all decreasing</p>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="rule1Check">
                                I can see a trend in this data
                            </label>
                        </div>
                    </div>

                    <div class="rule-card">
                        <h4>⬆️ Rule 2: Shift</h4>
                        <p class="definition">8 or more consecutive points all above OR all below the median</p>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="rule2Check">
                                I can see a shift in this data
                            </label>
                        </div>
                    </div>

                    <div class="rule-card">
                        <h4>🔀 Rule 3: Too Few Crossings</h4>
                        <p class="definition">Fewer crossings of the median than expected</p>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="rule3Check">
                                I can see too few crossings in this data
                            </label>
                        </div>
                    </div>
                </div>

                <button class="btn-primary" onclick="checkRules()" style="width: 100%; margin: 20px 0;">Check My Answers</button>

                <div id="rulesFeedback" class="feedback"></div>

                <button class="hint-button" onclick="toggleHint('rulesHint')">💡 Need guidance?</button>
                <div id="rulesHint" class="hint-box">
                    <strong>Analysis hints:</strong><br><br>
                    <strong>Trend:</strong> Look at weeks 1-9. Are the values generally decreasing over time? Count consecutive decreases.<br><br>
                    <strong>Shift:</strong> Look at weeks 8-12. Are all these points above or below the median (3.55)?<br><br>
                    <strong>Too Few Crossings:</strong> Count how many times the line crosses the median. Does it cross frequently, or stay on one side for long periods?
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn-primary" id="rulesCompleteBtn" disabled onclick="nextStep()">Continue →</button>
                </div>
            </div>

            <!-- STEP 5: CRITICAL THINKING -->
            <div class="step" id="step5">
                <h2>🤔 Step 5: Critical Analysis & Interpretation</h2>
                <p style="margin: 20px 0;">Now for the most important part - interpreting what this data means for improvement. These questions require critical thinking, not just rule application.</p>

                <div class="question-box">
                    <h4>Question 1: What system change might explain the improvement pattern?</h4>
                    <p style="margin-bottom: 15px; color: #666;">Something changed around Week 4-5 that started the downward trend. What might have been implemented?</p>
                    <textarea id="q1Answer" placeholder="Type your thoughts here... Consider interventions like new triage protocols, additional staffing, fast-track pathways, or diagnostic process changes."></textarea>
                    <button class="btn-secondary" onclick="toggleModelAnswer('q1')" style="margin-top: 10px; width: auto;">Show Model Answer</button>
                    <div id="q1Model" class="model-answer">
                        <h5>Model Answer:</h5>
                        <p>The downward trend beginning around Week 4-5 suggests a system-level intervention was introduced and had sustained effect. Possible explanations include:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>New triage protocol:</strong> Faster initial assessment process implemented</li>
                            <li><strong>Staffing change:</strong> Additional ED consultants or advanced nurse practitioners added</li>
                            <li><strong>Fast-track pathway:</strong> Minor injury stream separated from main ED flow</li>
                            <li><strong>Diagnostic process improvement:</strong> Point-of-care testing or rapid radiology slots</li>
                            <li><strong>Bed management:</strong> Real-time bed allocation system implemented</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Key Insight:</strong> The run chart tells you <em>when</em> improvement happened. Your job is to investigate <em>what</em> changed at that time and <em>why</em> it worked, so you can replicate or spread the success.</p>
                    </div>
                </div>

                <div class="question-box">
                    <h4>Question 2: Around which week did waiting times cross below the 3.0-hour target?</h4>
                    <p style="margin-bottom: 15px; color: #666;">Look at your chart. When did performance first achieve the improvement aim?</p>
                    <textarea id="q2Answer" placeholder="Type your answer..."></textarea>
                    <button class="btn-secondary" onclick="toggleModelAnswer('q2')" style="margin-top: 10px; width: auto;">Show Model Answer</button>
                    <div id="q2Model" class="model-answer">
                        <h5>Model Answer:</h5>
                        <p><strong>Week 9</strong> was the first time waiting times crossed below the 3.0-hour target (Week 9 = 3.2 hours is actually still above, but Week 12 = 3.1 hours is the first definitively below).</p>
                        <p style="margin-top: 10px;"><strong>Important Observations:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Week 9: 3.2 hours (close but not quite at target)</li>
                            <li>Week 10: 3.5 hours (temporary increase - common cause variation)</li>
                            <li>Week 11: 3.3 hours (back on downward trend)</li>
                            <li>Week 12: 3.1 hours (closest to target achieved)</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Critical Insight:</strong> Improvement isn't a straight line. Week 10's uptick doesn't mean failure - it's normal variation. The overall trend is what matters. You'd need several more weeks of data to confidently say the improvement is sustained.</p>
                    </div>
                </div>

                <div class="question-box">
                    <h4>Question 3: What balancing measures should you monitor to ensure you're not causing unintended harm?</h4>
                    <p style="margin-bottom: 15px; color: #666;">Reducing waiting times is good, but what could go wrong if you push too hard? How would you detect it?</p>
                    <textarea id="q3Answer" placeholder="Think about what might be sacrificed to achieve faster wait times..."></textarea>
                    <button class="btn-secondary" onclick="toggleModelAnswer('q3')" style="margin-top: 10px; width: auto;">Show Model Answer</button>
                    <div id="q3Model" class="model-answer">
                        <h5>Model Answer:</h5>
                        <p><strong>Essential Balancing Measures:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>72-hour re-attendance rate:</strong> Are patients being discharged prematurely and returning sicker?</li>
                            <li><strong>Diagnostic test completion rate:</strong> Are essential investigations being skipped to save time?</li>
                            <li><strong>Complaints about quality of care:</strong> Are patients feeling rushed or not properly assessed?</li>
                            <li><strong>Admission rates:</strong> Are you admitting patients unnecessarily to clear ED rather than treating and discharging?</li>
                            <li><strong>Did Not Wait (DNW) rates:</strong> Are patients leaving before treatment because they can't wait?</li>
                            <li><strong>Staff safety incidents:</strong> Are staff being pressured to work unsafely fast?</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Critical Principle:</strong> Every improvement has trade-offs. Never optimize one metric in isolation. Always ask: "What could we be making worse while improving this?"</p>
                    </div>
                </div>

                <div class="question-box">
                    <h4>Question 4: Is the data showing common cause or special cause variation? How do you know?</h4>
                    <p style="margin-bottom: 15px; color: #666;">Think about what the run chart rules revealed.</p>
                    <textarea id="q4Answer" placeholder="Consider the trend you identified and what it means..."></textarea>
                    <button class="btn-secondary" onclick="toggleModelAnswer('q4')" style="margin-top: 10px; width: auto;">Show Model Answer</button>
                    <div id="q4Model" class="model-answer">
                        <h5>Model Answer:</h5>
                        <p><strong>This data shows SPECIAL CAUSE variation.</strong></p>
                        <p style="margin-top: 10px;"><strong>Evidence:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>The overall downward trend (particularly weeks 3-12) suggests something in the system fundamentally changed</li>
                            <li>Performance moved from averaging 4+ hours to consistently under 3.5 hours</li>
                            <li>This pattern is unlikely to occur by random chance - something caused it</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>What to do with special cause variation:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>If good (like this):</strong> Investigate what caused it and replicate it elsewhere</li>
                            <li><strong>If bad:</strong> Investigate and eliminate the root cause</li>
                        </ul>
                        <p style="margin-top: 15px;"><strong>Note:</strong> Individual data points (like Week 7's uptick or Week 10's increase) are likely common cause - normal variation around the improving trend. Don't over-react to every wobble.</p>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">← Back</button>
                    <button class="btn-primary" onclick="nextStep()">Continue to Summary →</button>
                </div>
            </div>

            <!-- STEP 6: COMPLETION SUMMARY -->
            <div class="step" id="step6">
                <div class="completion-summary">
                    <div class="checkmark">✅</div>
                    <h3>Congratulations! You've Built Your First Run Chart!</h3>
                    <p style="font-size: 1.2em; margin-top: 20px;">You've successfully completed all components of run chart analysis.</p>
                </div>

                <div class="key-insights">
                    <h4>🎯 Key Learning Points</h4>
                    <ul>
                        <li><strong>Time-ordered data reveals patterns:</strong> Plotting data over time shows when changes occur - something averages can never do</li>
                        <li><strong>Median provides context:</strong> The median line helps you see whether data points are within normal range or represent genuine shifts</li>
                        <li><strong>Rules distinguish signal from noise:</strong> Trends and shifts indicate special cause variation requiring investigation</li>
                        <li><strong>Interpretation requires critical thinking:</strong> The chart shows <em>when</em> change happened; you must investigate <em>why</em></li>
                        <li><strong>Always consider balancing measures:</strong> Improvement on one metric might cause harm elsewhere</li>
                        <li><strong>Context matters:</strong> Understanding your system helps you interpret what the data means</li>
                    </ul>
                </div>

                <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; margin: 30px 0;">
                    <h4 style="color: #667eea; margin-bottom: 20px;">📚 Connecting to Your Module</h4>
                    <p style="line-height: 1.8;"><strong>For your HLTH09013 assessment:</strong> You now understand how to select and justify measurement approaches. When proposing a quality improvement project, you can explain why run charts are appropriate for your context (small dataset, rapid PDSA cycles, front-line accessibility) compared to alternatives like balanced scorecards or statistical process control.</p>
                    <p style="line-height: 1.8; margin-top: 15px;"><strong>Critical evaluation:</strong> You've learned that run chart rules are guidelines, not absolute laws. You must use professional judgment alongside the rules - exactly the kind of SCQF Level 9 thinking your assessment requires.</p>
                </div>

                <div style="background: #e8eaf6; padding: 20px; border-radius: 8px; border-left: 5px solid #667eea; margin: 30px 0;">
                    <h4 style="color: #667eea; margin-bottom: 10px;">📖 Further Reading</h4>
                    <ul style="margin-left: 20px; line-height: 1.8;">
                        <li>Perla, R.J., Provost, L.P., & Murray, S.K. (2011). The run chart: a simple analytical tool for learning from variation in healthcare processes. <em>BMJ Quality & Safety</em>, 20(1), 46-51.</li>
                        <li>Provost, L.P., & Murray, S.K. (2011). <em>The Health Care Data Guide: Learning from Data for Improvement</em>. Jossey-Bass.</li>
                    </ul>
                </div>

                <div class="button-group">
                    <button class="btn-secondary" onclick="prevStep()">← Review Activity</button>
                    <button class="btn-success" onclick="exportResults()">📥 Export My Work</button>
                    <button class="btn-primary" onclick="restartActivity()">🔄 Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data
        const weeklyData = [
            {week: 1, value: 4.2},
            {week: 2, value: 3.9},
            {week: 3, value: 4.1},
            {week: 4, value: 3.8},
            {week: 5, value: 3.6},
            {week: 6, value: 3.5},
            {week: 7, value: 3.7},
            {week: 8, value: 3.4},
            {week: 9, value: 3.2},
            {week: 10, value: 3.5},
            {week: 11, value: 3.3},
            {week: 12, value: 3.1}
        ];

        const correctMedian = 3.55;
        const targetValue = 3.0;
        let currentStep = 1;
        let chartCanvas, ctx;
        let plotComplete = false;
        let medianComplete = false;
        let rulesComplete = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            displayDataTable();
            updateProgress();
        });

        function displayDataTable() {
            const container = document.getElementById('dataDisplay');
            weeklyData.forEach(item => {
                const cell = document.createElement('div');
                cell.className = 'data-cell';
                cell.innerHTML = `
                    <div class="week">Week ${item.week}</div>
                    <div class="value">${item.value}</div>
                `;
                container.appendChild(cell);
            });
        }

        function nextStep() {
            if (currentStep < 6) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateStepCounter();
                updateProgress();
                
                if (currentStep === 2) {
                    setTimeout(initChart, 100);
                }
                if (currentStep === 3) {
                    displayOrderedValues();
                }
                if (currentStep === 4) {
                    setTimeout(drawCompleteChart, 100);
                }
                
                window.scrollTo({top: 0, behavior: 'smooth'});
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateStepCounter();
                updateProgress();
                window.scrollTo({top: 0, behavior: 'smooth'});
            }
        }

        function updateStepCounter() {
            const stepNames = [
                'Introduction',
                'Plot Data Points',
                'Calculate Median',
                'Apply Run Chart Rules',
                'Critical Analysis',
                'Summary & Completion'
            ];
            document.getElementById('stepCounter').textContent = 
                `Step ${currentStep} of 6: ${stepNames[currentStep - 1]}`;
        }

        function updateProgress() {
            const progress = ((currentStep - 1) / 5) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function initChart() {
            chartCanvas = document.getElementById('chartCanvas');
            ctx = chartCanvas.getContext('2d');
            
            // Auto-draw chart with animation
            drawChartBackground();
            animateDataPoints();
        }

        function drawChartBackground() {
            ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
            
            // Draw axes
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, 50);
            ctx.lineTo(50, 350);
            ctx.lineTo(750, 350);
            ctx.stroke();
            
            // Y-axis labels (2.0 to 4.5 hours)
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'right';
            for (let i = 2.0; i <= 4.5; i += 0.5) {
                const y = 350 - ((i - 2.0) / 2.5) * 300;
                ctx.fillText(i.toFixed(1), 45, y + 5);
                
                // Grid lines
                ctx.strokeStyle = '#e9ecef';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(50, y);
                ctx.lineTo(750, y);
                ctx.stroke();
            }
            
            // X-axis labels
            ctx.textAlign = 'center';
            for (let i = 1; i <= 12; i++) {
                const x = 50 + ((i - 0.5) / 12) * 700;
                ctx.fillText(`W${i}`, x, 370);
            }
            
            // Draw target line (3.0 hours)
            const targetY = 350 - ((targetValue - 2.0) / 2.5) * 300;
            ctx.strokeStyle = '#28a745';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(50, targetY);
            ctx.lineTo(750, targetY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Target label
            ctx.fillStyle = '#28a745';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('Target: 3.0 hours', 760, targetY + 5);
            
            // Axis labels
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Week', 400, 395);
            
            ctx.save();
            ctx.translate(15, 200);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('Waiting Time (hours)', 0, 0);
            ctx.restore();
        }

        function animateDataPoints() {
            let index = 0;
            const interval = setInterval(() => {
                if (index < weeklyData.length) {
                    drawDataPoint(weeklyData[index]);
                    if (index > 0) {
                        drawLine(weeklyData[index - 1], weeklyData[index]);
                    }
                    index++;
                } else {
                    clearInterval(interval);
                    plotComplete = true;
                    document.getElementById('plotCompleteBtn').disabled = false;
                    showPlotFeedback();
                }
            }, 300);
        }

        function drawDataPoint(dataPoint) {
            const x = 50 + ((dataPoint.week - 0.5) / 12) * 700;
            const y = 350 - ((dataPoint.value - 2.0) / 2.5) * 300;
            
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#4c51bf';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawLine(fromPoint, toPoint) {
            const x1 = 50 + ((fromPoint.week - 0.5) / 12) * 700;
            const y1 = 350 - ((fromPoint.value - 2.0) / 2.5) * 300;
            const x2 = 50 + ((toPoint.week - 0.5) / 12) * 700;
            const y2 = 350 - ((toPoint.value - 2.0) / 2.5) * 300;
            
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();
        }

        function showPlotFeedback() {
            const feedback = document.getElementById('plotFeedback');
            feedback.className = 'feedback correct';
            feedback.innerHTML = `
                <strong>✅ Excellent!</strong> You've successfully plotted all 12 weeks of data.<br><br>
                <strong>What do you notice?</strong> There's a clear downward trend from Week 1 (4.2 hours) to Week 12 (3.1 hours). 
                The pattern isn't perfectly smooth - Week 7 and Week 10 show slight increases - but the overall direction is improvement.
                This is exactly what real improvement data looks like!
            `;
        }

        function displayOrderedValues() {
            const container = document.getElementById('orderedValues');
            const values = weeklyData.map(d => d.value).sort((a, b) => a - b);
            
            values.forEach((value, index) => {
                const span = document.createElement('div');
                span.className = 'ordered-value';
                if (index === 5 || index === 6) {
                    span.classList.add('median');
                }
                span.textContent = value.toFixed(1);
                container.appendChild(span);
            });
        }

        function checkMedian() {
            const input = document.getElementById('medianInput');
            const userValue = parseFloat(input.value);
            const feedback = document.getElementById('medianFeedback');
            
            if (Math.abs(userValue - correctMedian) < 0.01) {
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                    <strong>🎉 Correct!</strong> The median is <strong>3.55 hours</strong>.<br><br>
                    This means half the weeks had waiting times above 3.55 hours, and half below. 
                    The median line will help us see whether individual data points are within normal variation or represent genuine shifts in performance.
                `;
                medianComplete = true;
                document.getElementById('medianCompleteBtn').disabled = false;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `
                    <strong>Not quite.</strong> Check your calculation:<br>
                    (3.5 + 3.6) ÷ 2 = ?<br><br>
                    Remember: Add the two middle values together, then divide by 2.
                    <button class="hint-button" onclick="toggleHint('medianHint')" style="margin-top: 10px;">Show me how</button>
                `;
            }
        }

        function drawCompleteChart() {
            const canvas2 = document.getElementById('chartCanvas2');
            const ctx2 = canvas2.getContext('2d');
            
            // Clear and draw background
            ctx2.clearRect(0, 0, canvas2.width, canvas2.height);
            
            // Draw axes
            ctx2.strokeStyle = '#333';
            ctx2.lineWidth = 2;
            ctx2.beginPath();
            ctx2.moveTo(50, 50);
            ctx2.lineTo(50, 350);
            ctx2.lineTo(750, 350);
            ctx2.stroke();
            
            // Y-axis labels
            ctx2.fillStyle = '#666';
            ctx2.font = '12px Arial';
            ctx2.textAlign = 'right';
            for (let i = 2.0; i <= 4.5; i += 0.5) {
                const y = 350 - ((i - 2.0) / 2.5) * 300;
                ctx2.fillText(i.toFixed(1), 45, y + 5);
                
                ctx2.strokeStyle = '#e9ecef';
                ctx2.lineWidth = 1;
                ctx2.beginPath();
                ctx2.moveTo(50, y);
                ctx2.lineTo(750, y);
                ctx2.stroke();
            }
            
            // X-axis labels
            ctx2.textAlign = 'center';
            for (let i = 1; i <= 12; i++) {
                const x = 50 + ((i - 0.5) / 12) * 700;
                ctx2.fillText(`W${i}`, x, 370);
            }
            
            // Draw target line
            const targetY = 350 - ((targetValue - 2.0) / 2.5) * 300;
            ctx2.strokeStyle = '#28a745';
            ctx2.lineWidth = 2;
            ctx2.setLineDash([5, 5]);
            ctx2.beginPath();
            ctx2.moveTo(50, targetY);
            ctx2.lineTo(750, targetY);
            ctx2.stroke();
            
            // Draw median line
            const medianY = 350 - ((correctMedian - 2.0) / 2.5) * 300;
            ctx2.strokeStyle = '#dc3545';
            ctx2.lineWidth = 2;
            ctx2.setLineDash([]);
            ctx2.beginPath();
            ctx2.moveTo(50, medianY);
            ctx2.lineTo(750, medianY);
            ctx2.stroke();
            
            // Labels
            ctx2.fillStyle = '#28a745';
            ctx2.font = 'bold 12px Arial';
            ctx2.textAlign = 'left';
            ctx2.fillText('Target: 3.0', 760, targetY + 5);
            
            ctx2.fillStyle = '#dc3545';
            ctx2.fillText('Median: 3.55', 760, medianY + 5);
            
            // Draw data points and lines
            weeklyData.forEach((point, index) => {
                const x = 50 + ((point.week - 0.5) / 12) * 700;
                const y = 350 - ((point.value - 2.0) / 2.5) * 300;
                
                // Line
                if (index > 0) {
                    const prevX = 50 + ((weeklyData[index - 1].week - 0.5) / 12) * 700;
                    const prevY = 350 - ((weeklyData[index - 1].value - 2.0) / 2.5) * 300;
                    ctx2.strokeStyle = '#667eea';
                    ctx2.lineWidth = 2;
                    ctx2.beginPath();
                    ctx2.moveTo(prevX, prevY);
                    ctx2.lineTo(x, y);
                    ctx2.stroke();
                }
                
                // Point
                ctx2.fillStyle = '#667eea';
                ctx2.beginPath();
                ctx2.arc(x, y, 6, 0, Math.PI * 2);
                ctx2.fill();
                ctx2.strokeStyle = '#4c51bf';
                ctx2.lineWidth = 2;
                ctx2.stroke();
            });
            
            // Axis labels
            ctx2.fillStyle = '#333';
            ctx2.font = 'bold 14px Arial';
            ctx2.textAlign = 'center';
            ctx2.fillText('Week', 400, 395);
            
            ctx2.save();
            ctx2.translate(15, 200);
            ctx2.rotate(-Math.PI / 2);
            ctx2.fillText('Waiting Time (hours)', 0, 0);
            ctx2.restore();
        }

        function checkRules() {
            const rule1 = document.getElementById('rule1Check').checked;
            const rule2 = document.getElementById('rule2Check').checked;
            const rule3 = document.getElementById('rule3Check').checked;
            const feedback = document.getElementById('rulesFeedback');
            
            // Correct answers: Yes to trend (there's a general downward trend)
            // The strict 6-point rule isn't perfectly met, but there's clear overall improvement
            
            let feedbackHTML = '<strong>Analysis of Run Chart Rules:</strong><br><br>';
            
            feedbackHTML += '<strong>Rule 1 - Trend:</strong> ';
            if (rule1) {
                feedbackHTML += '✅ <strong>Correct!</strong> While Week 7 breaks a perfect consecutive sequence, there is a clear downward trend from Week 1 to Week 12. The overall pattern shows sustained improvement, which is what matters clinically even if it doesn\'t meet the strict "6 consecutive points" rule perfectly.<br><br>';
            } else {
                feedbackHTML += '⚠️ <strong>Reconsider:</strong> Look at the overall pattern from Week 1 (4.2 hours) to Week 12 (3.1 hours). While not perfectly consecutive due to Week 7, there\'s a clear downward trend indicating special cause variation.<br><br>';
            }
            
            feedbackHTML += '<strong>Rule 2 - Shift:</strong> ';
            if (!rule2) {
                feedbackHTML += '✅ <strong>Correct!</strong> There is NO shift detected by the strict 8-point rule. While weeks 8-12 are all below the median (3.55), that\'s only 5 consecutive points, not 8.<br><br>';
            } else {
                feedbackHTML += '⚠️ <strong>Not quite:</strong> A shift requires 8 or more consecutive points all on one side of the median. Count carefully - we don\'t have 8 consecutive points all below (or all above) the median line.<br><br>';
            }
            
            feedbackHTML += '<strong>Rule 3 - Too Few Crossings:</strong> ';
            feedbackHTML += 'This rule requires statistical tables to apply precisely. The key insight is that the data stays below the median for the last several weeks, suggesting sustained improvement rather than random variation.<br><br>';
            
            feedbackHTML += '<strong>⚠️ Important Learning Point:</strong> Run chart rules are <em>guidelines</em>, not absolute laws. Even though the strict 6-point trend rule isn\'t perfectly met (due to Week 7), the clinical reality is clear: performance has genuinely improved. This is where professional judgment complements rule application - exactly the kind of critical thinking your assessment requires!';
            
            feedback.className = 'feedback info';
            feedback.innerHTML = feedbackHTML;
            
            rulesComplete = true;
            document.getElementById('rulesCompleteBtn').disabled = false;
        }

        function toggleHint(hintId) {
            const hint = document.getElementById(hintId);
            hint.classList.toggle('visible');
        }

        function toggleModelAnswer(questionNum) {
            const model = document.getElementById(`q${questionNum}Model`);
            model.classList.toggle('visible');
        }

        function exportResults() {
            const answers = {
                q1: document.getElementById('q1Answer').value,
                q2: document.getElementById('q2Answer').value,
                q3: document.getElementById('q3Answer').value,
                q4: document.getElementById('q4Answer').value
            };
            
            let exportText = `RUN CHART ACTIVITY - MY WORK\n`;
            exportText += `Week 9: Measuring Quality & Safety\n`;
            exportText += `Date: ${new Date().toLocaleDateString()}\n\n`;
            exportText += `===============================\n\n`;
            
            exportText += `SCENARIO:\n`;
            exportText += `Emergency Department - Weekly Average Waiting Time\n`;
            exportText += `Improvement Aim: Reduce waiting time to below 3.0 hours\n\n`;
            
            exportText += `DATA:\n`;
            weeklyData.forEach(d => {
                exportText += `Week ${d.week}: ${d.value} hours\n`;
            });
            
            exportText += `\nCALCULATED MEDIAN: 3.55 hours\n\n`;
            
            exportText += `MY CRITICAL ANALYSIS:\n\n`;
            exportText += `Q1: What system change might explain the improvement?\n`;
            exportText += `${answers.q1 || '[Not answered]'}\n\n`;
            
            exportText += `Q2: When did we achieve the 3.0-hour target?\n`;
            exportText += `${answers.q2 || '[Not answered]'}\n\n`;
            
            exportText += `Q3: What balancing measures should we monitor?\n`;
            exportText += `${answers.q3 || '[Not answered]'}\n\n`;
            
            exportText += `Q4: Common or special cause variation?\n`;
            exportText += `${answers.q4 || '[Not answered]'}\n\n`;
            
            exportText += `===============================\n`;
            exportText += `Completed: ${new Date().toLocaleString()}\n`;
            
            const blob = new Blob([exportText], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Run_Chart_Activity_Results.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('✅ Your work has been exported! You can now upload this file to your portfolio or reference it in your assessment.');
        }

        function restartActivity() {
            if (confirm('Are you sure you want to start over? Your progress will be lost.')) {
                location.reload();
            }
        }
    </script>
</body>
</html>